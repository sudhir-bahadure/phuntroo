<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Phuntroo Avatar - Asian Female</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #f9fafb;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #app {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 420px);
      gap: 0.75rem;
      padding: 0.75rem;
    }

    #avatarCanvas {
      width: 100%;
      height: 100%;
      border-radius: 1.25rem;
      background: radial-gradient(circle at top, #0b1120 0, #020617 60%, #000 100%);
      border: 1px solid rgba(15, 23, 42, 0.9);
    }

    #sidePanel {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .glass {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 1.25rem;
      padding: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      padding: 0.5rem 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at top left, #111827 0, #020617 60%, #000 100%);
      color: #e5e7eb;
      font-size: 0.85rem;
    }

    #status {
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="avatarCanvas"></div>
    <div id="sidePanel">
      <div class="glass">
        <div id="status">Loading Three.js...</div>
      </div>
      <div class="glass">
        <button onclick="window.location.href='https://sudhir-bahadure.github.io/phuntroo/'">← Back to Main App</button>
      </div>
    </div>
  </div>

  <!-- Load Three.js from CDN (UMD version, not ES6 modules) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/controls/OrbitControls.js"></script>

  <script>
    let scene, camera, renderer, controls, mixer, avatar;
    const clock = new THREE.Clock();

    function setStatus(text) {
      document.getElementById("status").textContent = text;
    }

    function init() {
      const container = document.getElementById("avatarCanvas");

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x020617);

      camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 100);
      camera.position.set(0, 1.6, 3);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.shadowMap.enabled = true;
      container.appendChild(renderer.domElement);

      const hemi = new THREE.HemisphereLight(0xffffff, 0x111827, 0.9);
      scene.add(hemi);

      const dir = new THREE.DirectionalLight(0xffffff, 1.1);
      dir.position.set(2, 4, 3);
      dir.castShadow = true;
      scene.add(dir);

      const ground = new THREE.Mesh(
        new THREE.CircleGeometry(3, 64),
        new THREE.MeshStandardMaterial({ color: 0x111827 })
      );
      ground.rotation.x = -Math.PI / 2;
      ground.receiveShadow = true;
      scene.add(ground);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.target.set(0, 1.3, 0);
      controls.enablePan = false;
      controls.minDistance = 2;
      controls.maxDistance = 4;

      window.addEventListener("resize", () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });

      loadAvatar();
      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      const dt = clock.getDelta();
      if (mixer) mixer.update(dt);
      if (avatar) {
        const t = clock.elapsedTime;
        avatar.position.x = Math.sin(t * 0.5) * 0.2;
        avatar.position.z = Math.cos(t * 0.5) * 0.1;
        avatar.position.y = 0.02 * Math.sin(t * 2.0);
      }
      if (controls) controls.update();
      renderer.render(scene, camera);
    }

    function loadAvatar() {
      setStatus("Loading Asian female avatar...");

      const loader = new THREE.GLTFLoader();
      loader.load(
        "./avatars/avatar.glb",
        (gltf) => {
          avatar = gltf.scene;
          avatar.traverse((obj) => {
            if (obj.isMesh) {
              obj.castShadow = true;
              obj.receiveShadow = true;
            }
          });
          avatar.position.set(0, 0, 0);
          avatar.rotation.y = Math.PI;
          scene.add(avatar);

          if (gltf.animations && gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(avatar);
            mixer.clipAction(gltf.animations[0]).play();
          }

          setStatus("✅ Avatar loaded! Drag to rotate, scroll to zoom.");
        },
        (progress) => {
          const percent = (progress.loaded / progress.total * 100).toFixed(0);
          setStatus(`Loading avatar... ${percent}%`);
        },
        (error) => {
          console.error(error);
          setStatus("❌ Failed to load avatar");
        }
      );
    }

    // Wait for Three.js to load, then initialize
    window.addEventListener("load", () => {
      if (typeof THREE !== 'undefined') {
        setStatus("Initializing 3D scene...");
        setTimeout(init, 100);
      } else {
        setStatus("❌ Failed to load Three.js");
      }
    });
  </script>
</body>

</html>